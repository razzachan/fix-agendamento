<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Tipos de Atendimento</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
        .info { border-left: 4px solid #17a2b8; }
        h1 { color: #333; text-align: center; }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>üß™ Teste - Tipos de Atendimento</h1>
    
    <div class="test-section">
        <h2>üìã Objetivo do Teste</h2>
        <p>Verificar se o middleware diferencia corretamente os tipos de atendimento:</p>
        <ul>
            <li><strong>coleta_diagnostico</strong> - Coleta para diagn√≥stico (R$ 350,00)</li>
            <li><strong>coleta_conserto</strong> - Coleta para conserto (pre√ßo vari√°vel)</li>
            <li><strong>em_domicilio</strong> - Atendimento em domic√≠lio</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üéØ Testes Dispon√≠veis</h2>
        <button class="test-button" onclick="testColetaDiagnostico()">1Ô∏è‚É£ Coleta Diagn√≥stico</button>
        <button class="test-button" onclick="testColetaConserto()">2Ô∏è‚É£ Coleta Conserto</button>
        <button class="test-button" onclick="testEmDomicilio()">3Ô∏è‚É£ Em Domic√≠lio</button>
        <button class="test-button" onclick="testSemTipo()">‚ùì Sem Tipo (Padr√£o)</button>
        <button class="test-button" onclick="testTodos()" style="background: #28a745;">üöÄ Executar Todos</button>
    </div>

    <div class="test-section">
        <h2>üìä Resultados dos Testes</h2>
        <div id="resultados"></div>
    </div>

    <script>
        const BASE_URL = "https://fix-agendamento-production.up.railway.app";
        const ENDPOINT = "/agendamento-inteligente";

        async function fazerRequisicao(dados, testName) {
            try {
                console.log(`üöÄ Executando ${testName}:`, dados);
                
                const response = await fetch(`${BASE_URL}${ENDPOINT}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dados)
                });

                const result = await response.json();
                
                const resultDiv = document.createElement('div');
                resultDiv.className = `result-box ${response.ok ? 'success' : 'error'}`;
                
                let html = `<strong>${testName}</strong><br>`;
                html += `Status: ${response.status}<br>`;
                
                if (response.ok) {
                    html += `‚úÖ Sucesso!<br>`;
                    html += `Mensagem: ${result.message || 'OK'}<br>`;
                    if (result.opcoes) {
                        html += `üìÖ Op√ß√µes de hor√°rio: ${result.opcoes.length}<br>`;
                    }
                    if (result.tipo_detectado) {
                        html += `üéØ Tipo detectado: ${result.tipo_detectado}<br>`;
                    }
                } else {
                    html += `‚ùå Erro!<br>`;
                    html += `Detalhes: ${JSON.stringify(result, null, 2)}<br>`;
                }
                
                html += `<br>Dados enviados:<br>${JSON.stringify(dados, null, 2)}`;
                html += `<br><br>Resposta completa:<br>${JSON.stringify(result, null, 2)}`;
                
                resultDiv.innerHTML = html;
                document.getElementById('resultados').appendChild(resultDiv);
                
                return { success: response.ok, data: result };
                
            } catch (error) {
                console.error(`‚ùå Erro em ${testName}:`, error);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-box error';
                resultDiv.innerHTML = `<strong>${testName}</strong><br>‚ùå Erro de conex√£o: ${error.message}`;
                document.getElementById('resultados').appendChild(resultDiv);
                
                return { success: false, error: error.message };
            }
        }

        async function testColetaDiagnostico() {
            const dados = {
                "nome": "Cliente Teste Diagn√≥stico",
                "endereco": "Rua Teste Diagn√≥stico, 123, Centro, Florian√≥polis, SC",
                "equipamento": "Fog√£o",
                "problema": "N√£o sei o que est√° acontecendo, precisa de diagn√≥stico",
                "telefone": "48999111001",
                "urgente": "n√£o",
                "cpf": "111.222.333-44",
                "email": "diagnostico@teste.com",
                "tipo_atendimento_1": "coleta_diagnostico"
            };
            
            return await fazerRequisicao(dados, "üîç TESTE 1: Coleta Diagn√≥stico");
        }

        async function testColetaConserto() {
            const dados = {
                "nome": "Cliente Teste Conserto",
                "endereco": "Rua Teste Conserto, 456, Centro, Florian√≥polis, SC",
                "equipamento": "Micro-ondas",
                "problema": "Precisa trocar a resist√™ncia",
                "telefone": "48999222002",
                "urgente": "n√£o",
                "cpf": "222.333.444-55",
                "email": "conserto@teste.com",
                "tipo_atendimento_1": "coleta_conserto"
            };
            
            return await fazerRequisicao(dados, "üîß TESTE 2: Coleta Conserto");
        }

        async function testEmDomicilio() {
            const dados = {
                "nome": "Cliente Teste Domic√≠lio",
                "endereco": "Rua Teste Domic√≠lio, 789, Centro, Florian√≥polis, SC",
                "equipamento": "Cooktop",
                "problema": "N√£o est√° funcionando",
                "telefone": "48999333003",
                "urgente": "n√£o",
                "cpf": "333.444.555-66",
                "email": "domicilio@teste.com",
                "tipo_atendimento_1": "em_domicilio"
            };
            
            return await fazerRequisicao(dados, "üè† TESTE 3: Em Domic√≠lio");
        }

        async function testSemTipo() {
            const dados = {
                "nome": "Cliente Teste Padr√£o",
                "endereco": "Rua Teste Padr√£o, 999, Centro, Florian√≥polis, SC",
                "equipamento": "Forno",
                "problema": "N√£o est√° aquecendo",
                "telefone": "48999444004",
                "urgente": "n√£o",
                "cpf": "444.555.666-77",
                "email": "padrao@teste.com"
                // SEM tipo_atendimento_1 - deve usar "em_domicilio" como padr√£o
            };
            
            return await fazerRequisicao(dados, "‚ùì TESTE 4: Sem Tipo (Padr√£o)");
        }

        async function testTodos() {
            document.getElementById('resultados').innerHTML = '<div class="result-box info"><strong>üöÄ Executando todos os testes...</strong></div>';
            
            const resultados = [];
            
            resultados.push(await testColetaDiagnostico());
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            resultados.push(await testColetaConserto());
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            resultados.push(await testEmDomicilio());
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            resultados.push(await testSemTipo());
            
            // Resumo
            const resumoDiv = document.createElement('div');
            resumoDiv.className = 'result-box info';
            
            let html = '<strong>üìä RESUMO DOS TESTES:</strong><br><br>';
            const testes = [
                'Coleta Diagn√≥stico',
                'Coleta Conserto', 
                'Em Domic√≠lio',
                'Sem Tipo (Padr√£o)'
            ];
            
            resultados.forEach((resultado, index) => {
                const status = resultado.success ? '‚úÖ PASSOU' : '‚ùå FALHOU';
                html += `${testes[index]}: ${status}<br>`;
            });
            
            html += '<br><strong>üéØ CONCLUS√ÉO:</strong><br>';
            const todosSucesso = resultados.every(r => r.success);
            if (todosSucesso) {
                html += '‚úÖ Todos os testes passaram! O middleware est√° diferenciando corretamente os tipos de atendimento.<br>';
            } else {
                html += '‚ùå Alguns testes falharam. Pode haver problema na l√≥gica do middleware.<br>';
            }
            
            html += '<br><strong>üìã PR√ìXIMO PASSO:</strong><br>';
            html += 'Verificar se o ClienteChat est√° enviando o par√¢metro "tipo_atendimento_1" corretamente.';
            
            resumoDiv.innerHTML = html;
            document.getElementById('resultados').appendChild(resumoDiv);
        }

        // Limpar resultados
        function limparResultados() {
            document.getElementById('resultados').innerHTML = '';
        }
    </script>
</body>
</html>
