<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste M√∫ltiplos Equipamentos</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { color: #e5b034; text-align: center; margin-bottom: 30px; }
        h3 { color: #333; border-bottom: 2px solid #e5b034; padding-bottom: 10px; }
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #e5b034;
        }
        button {
            background: linear-gradient(45deg, #e5b034, #f4c430);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 176, 52, 0.4);
        }
        .resultado {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-200 { border-left: 5px solid #28a745; }
        .status-error { border-left: 5px solid #dc3545; }
        .dados-enviados { background: #e3f2fd; }
        .resposta-recebida { background: #f3e5f5; }
        .timestamp { color: #666; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste M√∫ltiplos Equipamentos - Sistema V4.0</h1>
        
        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 1: Cliente com 2 Equipamentos (Tipos Diferentes)</h3>
            <p><strong>Situa√ß√£o:</strong> Fog√£o com problema desconhecido + Forno que precisa trocar resist√™ncia</p>
            <button onclick="testarCenario1Etapa1()">üöÄ ETAPA 1: Consultar Hor√°rios</button>
            <button onclick="testarCenario1Etapa2()">‚úÖ ETAPA 2: Confirmar (Op√ß√£o 2)</button>
            <div id="resultado-cenario1" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 2: Cliente com 3 Equipamentos (Todos Tipos)</h3>
            <p><strong>Situa√ß√£o:</strong> Fog√£o (diagn√≥stico) + Forno (conserto) + Cooktop (domic√≠lio)</p>
            <button onclick="testarCenario2Etapa1()">üöÄ ETAPA 1: Consultar Hor√°rios</button>
            <button onclick="testarCenario2Etapa2()">‚úÖ ETAPA 2: Confirmar (Op√ß√£o 1)</button>
            <div id="resultado-cenario2" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 3: Cliente Novo (Verificar Cria√ß√£o no Banco)</h3>
            <p><strong>Situa√ß√£o:</strong> Cliente completamente novo para testar cria√ß√£o autom√°tica</p>
            <button onclick="testarCenario3Etapa1()">üöÄ ETAPA 1: Consultar Hor√°rios</button>
            <button onclick="testarCenario3Etapa2()">‚úÖ ETAPA 2: Confirmar (Op√ß√£o 3)</button>
            <div id="resultado-cenario3" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 4: TESTE CRIA√á√ÉO DE OS (Novo Cliente)</h3>
            <p><strong>Situa√ß√£o:</strong> Teste espec√≠fico para verificar cria√ß√£o autom√°tica de OS</p>
            <button onclick="testarCenario4Etapa2()">üöÄ TESTE DIRETO: Criar OS Automaticamente</button>
            <div id="resultado-cenario4" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 5: TESTE ATRIBUI√á√ÉO T√âCNICOS ESPEC√çFICOS</h3>
            <p><strong>Situa√ß√£o:</strong> Coifa (Marcelo) + Fog√£o (Paulo Cesar)</p>
            <button onclick="testarCenario5Etapa2()">üöÄ TESTE T√âCNICOS: Coifa + Fog√£o</button>
            <div id="resultado-cenario5" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 6: TESTE CRIA√á√ÉO CLIENTE COMPLETA</h3>
            <p><strong>Situa√ß√£o:</strong> Verificar email correto + senha 123456</p>
            <button onclick="testarCenario6Etapa2()">üöÄ TESTE CLIENTE: Email + Senha</button>
            <div id="resultado-cenario6" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 7: TESTE ATUALIZA√á√ÉO EMAIL EXISTENTE</h3>
            <p><strong>Situa√ß√£o:</strong> Usar telefone existente para testar atualiza√ß√£o</p>
            <button onclick="testarCenario7Etapa2()">üöÄ TESTE ATUALIZA√á√ÉO: Email Existente</button>
            <div id="resultado-cenario7" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 8: TESTE DEBUG EMAIL</h3>
            <p><strong>Situa√ß√£o:</strong> Teste simples para debug de email</p>
            <button onclick="testarCenario8Etapa2()">üöÄ TESTE DEBUG: Email Simples</button>
            <div id="resultado-cenario8" class="resultado"></div>
        </div>

        <div class="test-section">
            <h3>üéØ CEN√ÅRIO 9: TESTE CRIA√á√ÉO AUTH SUPABASE</h3>
            <p><strong>Situa√ß√£o:</strong> Verificar se usu√°rio Auth √© criado automaticamente</p>
            <button onclick="testarCenario9Etapa2()">üöÄ TESTE AUTH: Novo Cliente + Login</button>
            <div id="resultado-cenario9" class="resultado"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://fix-agendamento-production.up.railway.app/agendamento-inteligente';

        function getTimestamp() {
            return new Date().toLocaleTimeString('pt-BR');
        }

        async function fazerRequisicao(dados, elementoId, etapa) {
            const elemento = document.getElementById(elementoId);
            
            try {
                elemento.innerHTML += `\n[${getTimestamp()}] üöÄ Iniciando ${etapa}...\n`;
                elemento.innerHTML += `üì§ DADOS ENVIADOS:\n${JSON.stringify(dados, null, 2)}\n`;
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dados)
                });

                const resultado = await response.json();
                
                elemento.innerHTML += `\n[${getTimestamp()}] üì° Status: ${response.status}\n`;
                elemento.innerHTML += `üì• RESPOSTA RECEBIDA:\n${JSON.stringify(resultado, null, 2)}\n`;
                elemento.className = `resultado ${response.ok ? 'status-200' : 'status-error'}`;
                
                if (resultado.sucesso) {
                    elemento.innerHTML += `\n‚úÖ ${etapa} executada com SUCESSO!\n`;
                } else {
                    elemento.innerHTML += `\n‚ùå ${etapa} FALHOU: ${resultado.mensagem}\n`;
                }
                
            } catch (error) {
                elemento.innerHTML += `\n[${getTimestamp()}] ‚ùå ERRO: ${error.message}\n`;
                elemento.className = 'resultado status-error';
            }
            
            elemento.scrollTop = elemento.scrollHeight;
        }

        // CEN√ÅRIO 1: 2 Equipamentos com tipos diferentes
        async function testarCenario1Etapa1() {
            const dados = {
                "cpf": "111.222.333-44",
                "nome": "Maria Silva",
                "email": "maria.silva@email.com",
                "urgente": "n√£o",
                "endereco": "Rua das Palmeiras, 456, Centro, Florian√≥polis, SC",
                "telefone": "48999887766",
                
                "equipamento": "fog√£o",
                "problema": "n√£o est√° funcionando direito, n√£o sei o que √©",
                "tipo_atendimento_1": "coleta_diagnostico",
                "valor_os_1": "350",
                
                "equipamento_2": "forno",
                "problema_2": "precisa trocar a resist√™ncia",
                "tipo_atendimento_2": "coleta_conserto", 
                "valor_os_2": "120",
                
                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": ""
            };
            
            await fazerRequisicao(dados, 'resultado-cenario1', 'ETAPA 1 - CEN√ÅRIO 1');
        }

        async function testarCenario1Etapa2() {
            const dados = {
                "cpf": "111.222.333-44",
                "nome": "Maria Silva", 
                "email": "maria.silva@email.com",
                "urgente": "n√£o",
                "endereco": "Rua das Palmeiras, 456, Centro, Florian√≥polis, SC",
                "telefone": "48999887766",
                
                "equipamento": "fog√£o",
                "problema": "n√£o est√° funcionando direito, n√£o sei o que √©",
                "tipo_atendimento_1": "coleta_diagnostico",
                "valor_os_1": "350",
                
                "equipamento_2": "forno",
                "problema_2": "precisa trocar a resist√™ncia", 
                "tipo_atendimento_2": "coleta_conserto",
                "valor_os_2": "120",
                
                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",
                
                "horario_escolhido": "2"
            };
            
            await fazerRequisicao(dados, 'resultado-cenario1', 'ETAPA 2 - CEN√ÅRIO 1');
        }

        // CEN√ÅRIO 2: 3 Equipamentos (todos os tipos)
        async function testarCenario2Etapa1() {
            const dados = {
                "cpf": "555.666.777-88",
                "nome": "Jo√£o Santos",
                "email": "joao.santos@email.com", 
                "urgente": "sim",
                "endereco": "Av. Beira Mar, 789, Trindade, Florian√≥polis, SC",
                "telefone": "48988776655",
                
                "equipamento": "fog√£o",
                "problema": "deu defeito mas n√£o sei o que √©",
                "tipo_atendimento_1": "coleta_diagnostico",
                "valor_os_1": "350",
                
                "equipamento_2": "forno",
                "problema_2": "sei que √© o termostato",
                "tipo_atendimento_2": "coleta_conserto",
                "valor_os_2": "180",
                
                "equipamento_3": "cooktop",
                "problema_3": "n√£o pode sair de casa",
                "tipo_atendimento_3": "em_domicilio", 
                "valor_os_3": "100"
            };
            
            await fazerRequisicao(dados, 'resultado-cenario2', 'ETAPA 1 - CEN√ÅRIO 2');
        }

        async function testarCenario2Etapa2() {
            const dados = {
                "cpf": "555.666.777-88",
                "nome": "Jo√£o Santos",
                "email": "joao.santos@email.com",
                "urgente": "sim", 
                "endereco": "Av. Beira Mar, 789, Trindade, Florian√≥polis, SC",
                "telefone": "48988776655",
                
                "equipamento": "fog√£o",
                "problema": "deu defeito mas n√£o sei o que √©",
                "tipo_atendimento_1": "coleta_diagnostico",
                "valor_os_1": "350",
                
                "equipamento_2": "forno",
                "problema_2": "sei que √© o termostato",
                "tipo_atendimento_2": "coleta_conserto",
                "valor_os_2": "180",
                
                "equipamento_3": "cooktop", 
                "problema_3": "n√£o pode sair de casa",
                "tipo_atendimento_3": "em_domicilio",
                "valor_os_3": "100",
                
                "horario_escolhido": "1"
            };
            
            await fazerRequisicao(dados, 'resultado-cenario2', 'ETAPA 2 - CEN√ÅRIO 2');
        }

        // CEN√ÅRIO 4: Teste direto de cria√ß√£o de OS
        async function testarCenario4Etapa2() {
            const dados = {
                "cpf": "555.444.333-22",
                "nome": "Teste T√©cnicos Auto",
                "email": "teste.tecnicos@email.com",
                "urgente": "n√£o",
                "endereco": "Rua T√©cnicos, 333, Centro, Florian√≥polis, SC",
                "telefone": "48955443322",

                "equipamento": "coifa",
                "problema": "n√£o funciona",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "200",

                "equipamento_2": "fog√£o",
                "problema_2": "n√£o acende",
                "tipo_atendimento_2": "coleta_conserto",
                "valor_os_2": "150",

                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",

                "horario_escolhido": "1"
            };

            await fazerRequisicao(dados, 'resultado-cenario4', 'TESTE ATRIBUI√á√ÉO T√âCNICOS - CEN√ÅRIO 4');
        }

        // CEN√ÅRIO 5: Teste t√©cnicos espec√≠ficos
        async function testarCenario5Etapa2() {
            const dados = {
                "cpf": "999.888.777-66",
                "nome": "Teste Especialistas",
                "email": "teste.especialistas@email.com",
                "urgente": "n√£o",
                "endereco": "Rua Especialistas, 444, Trindade, Florian√≥polis, SC",
                "telefone": "48999887766",

                "equipamento": "coifa",
                "problema": "n√£o aspira",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "250",

                "equipamento_2": "fog√£o",
                "problema_2": "n√£o acende",
                "tipo_atendimento_2": "coleta_conserto",
                "valor_os_2": "180",

                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",

                "horario_escolhido": "2"
            };

            await fazerRequisicao(dados, 'resultado-cenario5', 'TESTE ESPECIALISTAS - CEN√ÅRIO 5');
        }

        // CEN√ÅRIO 6: Teste cria√ß√£o cliente completa
        async function testarCenario6Etapa2() {
            const dados = {
                "cpf": "111.333.555-77",
                "nome": "Cliente Email Senha",
                "email": "email.atualizado.agora@teste.com",
                "urgente": "n√£o",
                "endereco": "Rua Email Atualizado, 777, Kobrasol, S√£o Jos√©, SC",
                "telefone": "48911335577",

                "equipamento": "aspirador",
                "problema": "n√£o aspira",
                "tipo_atendimento_1": "coleta_conserto",
                "valor_os_1": "200",

                "equipamento_2": "",
                "problema_2": "",
                "tipo_atendimento_2": "",
                "valor_os_2": "",

                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",

                "horario_escolhido": "3"
            };

            await fazerRequisicao(dados, 'resultado-cenario6', 'TESTE ATUALIZA√á√ÉO EMAIL - CEN√ÅRIO 6');
        }

        // CEN√ÅRIO 7: Teste atualiza√ß√£o email existente
        async function testarCenario7Etapa2() {
            const dados = {
                "cpf": "111.333.555-77",
                "nome": "Cliente Email Senha",
                "email": "email.super.novo@teste.com",
                "urgente": "n√£o",
                "endereco": "Rua Email Super Novo, 888, Kobrasol, S√£o Jos√©, SC",
                "telefone": "48911335577", // MESMO TELEFONE DO CLIENTE EXISTENTE

                "equipamento": "ferro de passar",
                "problema": "n√£o esquenta",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "80",

                "equipamento_2": "",
                "problema_2": "",
                "tipo_atendimento_2": "",
                "valor_os_2": "",

                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",

                "horario_escolhido": "1"
            };

            await fazerRequisicao(dados, 'resultado-cenario7', 'TESTE ATUALIZA√á√ÉO EMAIL - CEN√ÅRIO 7');
        }

        // CEN√ÅRIO 8: Teste debug email
        async function testarCenario8Etapa2() {
            const dados = {
                "cpf": "999.111.222-33",
                "nome": "Debug Email Teste",
                "email": "debug.email.teste@teste.com",
                "urgente": "n√£o",
                "endereco": "Rua Debug, 999, Centro, Florian√≥polis, SC",
                "telefone": "48999111222",

                "equipamento": "cafeteira",
                "problema": "n√£o funciona",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "100",

                "equipamento_2": "",
                "problema_2": "",
                "tipo_atendimento_2": "",
                "valor_os_2": "",

                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",

                "horario_escolhido": "1"
            };

            await fazerRequisicao(dados, 'resultado-cenario8', 'TESTE DEBUG EMAIL - CEN√ÅRIO 8');
        }

        // CEN√ÅRIO 9: Teste cria√ß√£o Auth Supabase
        async function testarCenario9Etapa2() {
            const dados = {
                "cpf": "555.999.888-77",
                "nome": "Cliente Login Completo",
                "email": "cliente.login.completo@teste.com",
                "urgente": "n√£o",
                "endereco": "Av. Login Completo, 555, Ingleses, Florian√≥polis, SC",
                "telefone": "48955999888",

                "equipamento": "batedeira",
                "problema": "n√£o mistura",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "90",

                "equipamento_2": "",
                "problema_2": "",
                "tipo_atendimento_2": "",
                "valor_os_2": "",

                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",

                "horario_escolhido": "3"
            };

            await fazerRequisicao(dados, 'resultado-cenario9', 'TESTE LOGIN COMPLETO - CEN√ÅRIO 9');
        }

        // CEN√ÅRIO 3: Cliente novo
        async function testarCenario3Etapa1() {
            const dados = {
                "cpf": "999.888.777-66",
                "nome": "Ana Costa",
                "email": "ana.costa@email.com",
                "urgente": "n√£o",
                "endereco": "Rua Nova, 123, Kobrasol, S√£o Jos√©, SC", 
                "telefone": "48977665544",
                
                "equipamento": "fog√£o",
                "problema": "n√£o acende",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "80",
                
                "equipamento_2": "",
                "problema_2": "",
                "tipo_atendimento_2": "",
                "valor_os_2": "",
                
                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": ""
            };
            
            await fazerRequisicao(dados, 'resultado-cenario3', 'ETAPA 1 - CEN√ÅRIO 3');
        }

        async function testarCenario3Etapa2() {
            const dados = {
                "cpf": "999.888.777-66",
                "nome": "Ana Costa",
                "email": "ana.costa@email.com",
                "urgente": "n√£o",
                "endereco": "Rua Nova, 123, Kobrasol, S√£o Jos√©, SC",
                "telefone": "48977665544",
                
                "equipamento": "fog√£o",
                "problema": "n√£o acende",
                "tipo_atendimento_1": "em_domicilio",
                "valor_os_1": "80",
                
                "equipamento_2": "",
                "problema_2": "",
                "tipo_atendimento_2": "",
                "valor_os_2": "",
                
                "equipamento_3": "",
                "problema_3": "",
                "tipo_atendimento_3": "",
                "valor_os_3": "",
                
                "horario_escolhido": "3"
            };
            
            await fazerRequisicao(dados, 'resultado-cenario3', 'ETAPA 2 - CEN√ÅRIO 3');
        }
    </script>
</body>
</html>
